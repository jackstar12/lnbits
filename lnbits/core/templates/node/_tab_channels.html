<q-tab-panel name="channels">
  <q-dialog v-model="connectPeerDialog.show">
    <q-card class="q-pa-lg q-pt-xl lnbits__dialog-card">
      <q-form class="q-gutter-md">
        <q-input
          dense
          type="text"
          filled
          v-model="connectPeerDialog.data.uri"
          label="Node URI"
          hint="pubkey@host:port"
        ></q-input>

        <div class="row q-mt-lg">
          <q-btn
            :label="$t('connect')"
            color="primary"
            @click="connectPeer"
          ></q-btn>
          <q-btn
            v-close-popup
            flat
            color="grey"
            class="q-ml-auto"
            :label="$t('cancel')"
          ></q-btn>
        </div>
      </q-form>
    </q-card>
  </q-dialog>

  <q-dialog v-model="openChannelDialog.show">
    <q-card class="q-pa-lg q-pt-xl lnbits__dialog-card">
      <q-form class="q-gutter-md">
        <q-input
          dense
          type="text"
          filled
          v-model="openChannelDialog.data.peer_id"
          label="Peer ID"
          hint="pubkey@host:port"
        ></q-input>
        <q-input
          dense
          type="number"
          filled
          v-model.number="openChannelDialog.data.funding_amount"
          label="Funding Amount"
        ></q-input>

        <div class="row q-mt-lg">
          <q-btn
            :label="$t('open')"
            color="primary"
            @click="openChannel"
          ></q-btn>
          <q-btn
            v-close-popup
            flat
            color="grey"
            class="q-ml-auto"
            :label="$t('cancel')"
          ></q-btn>
        </div>
      </q-form>
    </q-card>
  </q-dialog>

  <q-card-section class="q-pa-none">
    <div class="row q-col-gutter-lg">
      <div class="col">
        <div class="col q-pb-lg">
          <q-card>
            <q-card-section>
              <h5 class="text-subtitle1 q-my-none">Channels</h5>
              {% raw %}
              <div v-for="channel in this.channels" :key="channel.peer_id">
                <div>
                  <div class="row items-center justify-between">
                    <span class="text-weight-thin">
                      Inbound: {{ formatMsat(channel.inbound_msat) }} sats
                    </span>
                    <span class="text-weight-thin">
                      Outbound: {{ formatMsat(channel.outbound_msat) }} sats
                    </span>
                  </div>

                  <q-linear-progress
                    class="q-mb-md"
                    size="25px"
                    :value="channel.inbound_msat / channel.total_msat"
                    :color="channel.color"
                    :style="`color: #${channel.color}`"
                  >
                    <div class="absolute-full flex flex-center">
                      <q-badge
                        color="white"
                        text-color="accent"
                        :label="`${channel.name} (${formatMsat(channel.total_msat)} sats)`"
                      >
                        {{ channel.alias }}
                      </q-badge>
                    </div>
                  </q-linear-progress>
                </div>
              </div>
              {% endraw %}
            </q-card-section>
          </q-card>
        </div>
        <div class="col q-pb-lg">
          <q-card>
            <q-card-section>
              <h5 class="text-subtitle1 q-my-none">Channels</h5>
              {% raw %}
              <q-table
                dense
                flat
                title="Channels"
                :data="this.channels"
                :pagination.sync="paymentsTable.pagination"
                no-data-label="No transactions made yet"
                :filter="paymentsTable.filter"
              >
                <template v-slot:top-right>
                  <q-btn
                    unelevated
                    color="primary"
                    class="full-width"
                    size="md"
                    @click="showOpenChannelDialog()"
                  >
                    Open channel
                  </q-btn>
                </template>
                <template v-slot:header="props">
                  <q-tr :props="props"> </q-tr>
                </template>
                <template v-slot:body="props">
                  <q-tr :props="props">
                    <div>
                      <div class="row items-center justify-between">
                        <span class="text-weight-thin">
                          Inbound: {{ formatMsat(props.row.inbound_msat) }} sats
                        </span>
                        <span class="text-weight-thin">
                          Outbound: {{ formatMsat(props.row.outbound_msat) }}
                          sats
                        </span>
                      </div>

                      <q-linear-progress
                        class="q-mb-md"
                        size="25px"
                        :value="props.row.inbound_msat / props.row.total_msat"
                        :color="props.row.color"
                        :style="`color: #${props.row.color}`"
                      >
                        <div class="absolute-full flex flex-center">
                          <q-badge
                            color="white"
                            text-color="accent"
                            :label="`${props.row.name} (${formatMsat(props.row.total_msat)} sats)`"
                          >
                            {{ props.row.alias }}
                          </q-badge>
                        </div>
                      </q-linear-progress>
                    </div>
                  </q-tr>
                </template>
              </q-table>

              {% endraw %}
            </q-card-section>
          </q-card>
        </div>
      </div>
      <div class="col">
        <div class="col q-pb-lg">
          <q-card>
            <q-card-section>
              <h5 class="text-subtitle1 q-my-none">Channels</h5>
              {% raw %}
              <div v-for="channel in this.channels" :key="channel.peer_id">
                <div>
                  <div class="row items-center justify-between">
                    <span class="text-weight-thin">
                      Inbound: {{ formatMsat(channel.inbound_msat) }} sats
                    </span>
                    <span class="text-weight-thin">
                      Outbound: {{ formatMsat(channel.outbound_msat) }} sats
                    </span>
                  </div>

                  <q-linear-progress
                    class="q-mb-md"
                    size="25px"
                    :value="channel.inbound_msat / channel.total_msat"
                    :color="channel.color"
                    :style="`color: #${channel.color}`"
                  >
                    <div class="absolute-full flex flex-center">
                      <q-badge
                        color="white"
                        text-color="accent"
                        :label="`${channel.name} (${formatMsat(channel.total_msat)} sats)`"
                      >
                        {{ channel.alias }}
                      </q-badge>
                    </div>
                  </q-linear-progress>
                </div>
              </div>
              {% endraw %}
            </q-card-section>
          </q-card>
        </div>
        <div class="col q-pb-lg">
          <q-card>
            <q-card-section>
              {% raw %}
              <q-table
                dense
                flat
                title="Peers"
                :data="this.peers"
                no-data-label="No transactions made yet"
              >
                <template v-slot:top-right>
                  <q-btn color="primary" @click="connectPeerDialog.show = true">
                    Connect Peer
                  </q-btn>
                </template>
                <template v-slot:header="props">
                  <q-tr :props="props"> </q-tr>
                </template>
                <template v-slot:body="props">
                  <q-tr :props="props">
                    <div
                      class="row justify-between no-wrap items-center q-gutter-sm"
                    >
                      <div class="q-my-sm">
                        <div class="text-subtitle1 text-bold">
                          {{ props.row.alias }}
                        </div>
                        <div class="row items-baseline q-gutter-sm">
                          <div
                            :style="`color: #${props.row.color}`"
                            class="text-bold"
                          >
                            Color #{{ props.row.color }}
                          </div>
                          <div>{{ props.row.id.substring(0,5) }}</div>
                        </div>
                      </div>
                      <q-btn
                        unelevated
                        color="primary"
                        @click="showOpenChannelDialog(props.row.id)"
                      >
                        Open channel
                      </q-btn>
                    </div>
                  </q-tr>
                </template>
              </q-table>

              {% endraw %}
            </q-card-section>
          </q-card>
        </div>
      </div>
    </div>
  </q-card-section>
</q-tab-panel>
