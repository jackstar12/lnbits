<q-tab-panel name="channels">
  <q-dialog v-model="connectPeerDialog.show">
    <q-card class="q-pa-lg q-pt-xl lnbits__dialog-card">
      <q-form class="q-gutter-md">
        <q-input
          dense
          type="text"
          filled
          v-model="connectPeerDialog.data.uri"
          label="Node URI"
          hint="pubkey@host:port"
        ></q-input>

        <div class="row q-mt-lg">
          <q-btn
            :label="$t('connect')"
            color="primary"
            @click="connectPeer"
          ></q-btn>
          <q-btn
            v-close-popup
            flat
            color="grey"
            class="q-ml-auto"
            :label="$t('cancel')"
          ></q-btn>
        </div>
      </q-form>
    </q-card>
  </q-dialog>

  <q-dialog v-model="openChannelDialog.show">
    <q-card class="q-pa-lg q-pt-xl lnbits__dialog-card">
      <q-form class="q-gutter-md">
        <q-input
          dense
          type="text"
          filled
          v-model="openChannelDialog.data.peer_id"
          label="Peer ID"
        ></q-input>
        <q-input
          dense
          type="number"
          filled
          v-model.number="openChannelDialog.data.funding_amount"
          label="Funding Amount"
        ></q-input>
        <q-expansion-item icon="warning" label="Advanced">
          <q-card>
            <q-card-section>
              <div class="column q-gutter-md">
                <q-input
                  dense
                  type="number"
                  filled
                  v-model.number="openChannelDialog.data.push_amount"
                  label="Push Amount"
                  hint="This gifts sats to the other side!"
                ></q-input>

                <q-input
                  dense
                  type="number"
                  filled
                  v-model.number="openChannelDialog.data.fee_rate"
                  label="Fee Rate"
                ></q-input>
              </div>
            </q-card-section>
          </q-card>
        </q-expansion-item>

        <div class="row q-mt-lg">
          <q-btn
            :label="$t('open')"
            color="primary"
            @click="openChannel"
          ></q-btn>
          <q-btn
            v-close-popup
            flat
            color="grey"
            class="q-ml-auto"
            :label="$t('cancel')"
          ></q-btn>
        </div>
      </q-form>
    </q-card>
  </q-dialog>

  <q-dialog v-model="closeChannelDialog.show">
    <q-card class="q-pa-lg q-pt-xl lnbits__dialog-card">
      <q-form class="q-gutter-md">
        <div>
          <q-checkbox v-model="closeChannelDialog.data.force" label="Force" />
        </div>

        <div class="row q-mt-lg">
          <q-btn
            :label="$t('close')"
            color="primary"
            @click="closeChannel"
          ></q-btn>
          <q-btn
            v-close-popup
            flat
            color="grey"
            class="q-ml-auto"
            :label="$t('cancel')"
          ></q-btn>
        </div>
      </q-form>
    </q-card>
  </q-dialog>

  <q-card-section class="q-pa-none">
    <div class="row q-col-gutter-lg">
      <div class="col-12 col-lg-6 q-pb-lg">
        <q-card class="full-height">
          <q-card-section>
            <div class="row items-center q-gutter-sm no-wrap">
              <div class="text-h6 q-my-none col-grow">Channels</div>
              <q-select
                dense
                size="sm"
                style="min-width: 200px"
                filled
                multiple
                clearable
                v-model="stateFilters"
                :options="this.states"
              ></q-select>
              <q-btn
                unelevated
                color="primary"
                size="md"
                @click="showOpenChannelDialog()"
              >
                Open channel
              </q-btn>
            </div>
            {% raw %}
            <div class="text-subtitle1 col-grow">Total</div>
            <lnbits-channel-balance
              :balance="this.activeBalance"
            ></lnbits-channel-balance>
            <q-table
              dense
              flat
              :data="this.filteredChannels"
              no-data-label="No channels opened"
            >
              <template v-slot:header="props">
                <q-tr :props="props"> </q-tr>
              </template>
              <template v-slot:body="props">
                <q-tr :props="props">
                  <div class="row items-center justify-between q-gutter-md">
                    <div class="col-grow">
                      <div class="row items-center q-gutter-sm">
                        <div class="text-subtitle1 col-grow">
                          {{props.row.name}}
                        </div>
                        <q-badge
                          rounded
                          :color="states.find(s => s.value == props.row.state)?.color"
                        >
                          {{ states.find(s => s.value == props.row.state)?.label
                          }}
                        </q-badge>
                        <q-btn
                          :disable='props.row.state !== "active"'
                          flat
                          dense
                          size="md"
                          @click="showCloseChannelDialog(props.row)"
                          icon="cancel"
                          color="pink"
                        ></q-btn>
                      </div>

                      <lnbits-channel-balance
                        :balance="props.row.balance"
                      ></lnbits-channel-balance>
                    </div>
                  </div>
                </q-tr>
              </template>
            </q-table>

            {% endraw %}
          </q-card-section>
        </q-card>
      </div>
      <div class="col-12 col-lg-6 q-pb-lg">
        <q-card class="full-height">
          <q-card-section>
            {% raw %}
            <div class="row items-center justify-between no-wrap">
              <div class="text-h6 q-my-none">Peers</div>
              <q-btn color="primary" @click="connectPeerDialog.show = true">
                Connect Peer
              </q-btn>
            </div>
            <q-table
              dense
              flat
              :data="this.peers"
              no-data-label="No transactions made yet"
            >
              <template v-slot:header="props">
                <q-tr :props="props"> </q-tr>
              </template>
              <template v-slot:body="props">
                <q-tr :props="props">
                  <div
                    class="row justify-between no-wrap items-center q-gutter-sm"
                  >
                    <div class="q-my-sm">
                      <div class="text-subtitle1 text-bold">
                        {{ props.row.alias }}
                      </div>
                      <div class="row items-center q-gutter-sm">
                        <q-badge
                          :style="`background-color: #${props.row.color}`"
                          class="text-bold"
                        >
                          #{{ props.row.color }}
                        </q-badge>
                        <div class="text-bold">
                          {{ shortenNodeId(props.row.id) }}
                        </div>
                        <q-btn
                          size="xs"
                          flat
                          dense
                          icon="content_paste"
                          @click="copyText(props.row.id)"
                        ></q-btn>
                        <q-btn
                          size="xs"
                          flat
                          dense
                          icon="qr_code"
                          @click="showNodeInfoDialog(props.row)"
                        ></q-btn>
                      </div>
                    </div>
                    <q-btn
                      unelevated
                      color="primary"
                      @click="showOpenChannelDialog(props.row.id)"
                    >
                      Open channel
                    </q-btn>
                  </div>
                </q-tr>
              </template>
            </q-table>

            {% endraw %}
          </q-card-section>
        </q-card>
      </div>
    </div>
  </q-card-section>
</q-tab-panel>
